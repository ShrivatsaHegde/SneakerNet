language: perl
perl:
  - "5.24-shrplib"
dist: xenial
addons:
  apt:
    sources:
    - boost-latest
    packages:
    - build-essential
    - file
    - git
    - libboost-all-dev
    #- libboost1.58-dev
    - bioperl
    - curl
    - ruby2.3-dev
    - rubygems
install:
  # Ruby
  #- export REALLY_GEM_UPDATE_SYSTEM=1
  #- sudo gem update --system # rubygems-update requires Ruby version >= 2.3.0
  #- ruby --version
  #- sudo ruby --version
  #- gem --version
  #- sudo gem --version
  # Homebrew stuff
  - export PATH=$PATH:$HOME/.linuxbrew/bin
  - git clone https://github.com/Homebrew/brew $HOME/.linuxbrew/Homebrew
  - mkdir $HOME/.linuxbrew/bin
  - ln -s ../Homebrew/bin/brew $HOME/.linuxbrew/bin
  - eval $($HOME/.linuxbrew/bin/brew shellenv)
  #- mkdir -pv /home/travis/.linuxbrew/etc /home/travis/.linuxbrew/include /home/travis/.linuxbrew/lib /home/travis/.linuxbrew/opt /home/travis/.linuxbrew/sbin /home/travis/.linuxbrew/share /home/travis/.linuxbrew/var/homebrew/linked /home/travis/.linuxbrew/Cellar
  #- chown -Rv $(whoami) /home/travis/.linuxbrew/etc /home/travis/.linuxbrew/include /home/travis/.linuxbrew/lib /home/travis/.linuxbrew/opt /home/travis/.linuxbrew/sbin /home/travis/.linuxbrew/share /home/travis/.linuxbrew/var/homebrew/linked /home/travis/.linuxbrew/Cellar
  # debug brew
  - brew doctor || true
  #- brew update
  #- brew update
  #- brew doctor || true
  # Dependencies for ruby on brew: pkg-config, libyaml, openssl, gpatch, ncurses and readline
  - travis_wait brew install pkg-config # First brew command might take a while and so prefix with travis_wait.
  - travis_wait brew install libyaml
  - travis_wait brew install openssl
  - travis_wait brew install gpatch
  - travis_wait brew install ncurses
  - travis_wait brew install readline
  # Ruby through brew
  - travis_wait brew install ruby # takes a while and so spawn a travis_wait process
  - gem --version
  - which gem
  - REALLY_GEM_UPDATE_SYSTEM=1 gem update --system
  - gem install activesupport plist backports
  - brew tap brewsci/bio
  - travis_wait brew install skesa
  - travis_wait 45 brew install blast # blast is a beast to install and it can take 30 minutes to finish
  - travis_wait brew install mlst
  - travis_wait brew install prokka
  #- find /usr /lib -type f -name program_options.hpp
  # Skesa. Requires BOOST.
  # - wget https://github.com/ncbi/SKESA/archive/v2.2.1.tar.gz
  # - tar zxvf v2.2.1.tar.gz
  # TODO figure out why skesa doesn't work on ubuntu
  #- make -C SKESA-2.2.1 -j 1 -f Makefile.nongs || true
  #- export PATH=$PATH:$(pwd -P)/SKESA-2.2.1
  # BLAST
  # - wget ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/2.8.1/ncbi-blast-2.8.1+-x64-linux.tar.gz
  # - tar zxvf ncbi-blast-2.8.1+-x64-linux.tar.gz
  # - export PATH=$PATH:$(pwd -P)/ncbi-blast-2.8.1+/bin
  # CGP
  - wget https://github.com/lskatz/CG-Pipeline/archive/v0.5.tar.gz
  - tar zxvf v0.5.tar.gz
  - export PATH=$PATH:$(pwd -P)/CG-Pipeline-0.5/scripts
  # prodigal
  #- wget https://github.com/hyattpd/Prodigal/archive/v2.6.3.tar.gz
  #- tar zxvf v2.6.3.tar.gz
  #- make -C Prodigal-2.6.3 -j 2
  #- export PATH=$PATH:$(pwd -P)/Prodigal-2.6.3
  # mlst
  #- wget https://github.com/tseemann/mlst/archive/v2.16.tar.gz
  #- tar zxvf v2.16.tar.gz
  #- export PATH=$PATH:$(pwd -P)/mlst-2.16/bin:mlst-2.16/scripts
  # TODO install kraken
  # Configure SneakerNet
  - cp -rv config.bak config
  - export PATH=$PATH:$(pwd -P)/scripts:$(pwd -P)/SneakerNet.plugins
script: cpanm --quiet --installdeps --notest .
