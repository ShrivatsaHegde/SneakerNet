# https://docs.github.com/en/actions/reference/encrypted-secrets#using-encrypted-secrets-in-a-workflow
# https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions
name: travis-docker
on: 
  push:
    branches:
      - docker-multistage
#steps:
#  - name: travis-docker-credentials
#    env:
#      DOCKER_PASSWORD: ${{  secrets.DOCKER_PASSWORD }}
#      DOCKER_USERNAME: ${{  secrets.DOCKER_USERNAME }}
jobs:
  docker_deploy:
    
    env:      
      DOCKER_PASSWORD: ${{  secrets.DOCKER_PASSWORD }}
      DOCKER_USERNAME: ${{  secrets.DOCKER_USERNAME }}
      CI_PROJECT_NAME: sneakernet
    runs-on: ubuntu-18.04
    steps:
      - id:  test-not-so-secret-variable
        run: echo "logging in with ${DOCKER_USERNAME:0:6}"
      - id:  test-docker-tag
        run: echo "$CI_PROJECT_NAME:$GITHUB_SHA"
      - id:  test-other-vars
        run: echo "HOME:$HOME PWD:$PWD"
      - id:  test-other-env
        run: ls
      - id:  docker-login
        run: echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin; echo $?
      - id:  docker-build
        run: docker build -t $CI_PROJECT_NAME:$GITHUB_SHA .
        working-directory: $HOME

